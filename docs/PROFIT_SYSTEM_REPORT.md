# ๐ ฺฏุฒุงุฑุด ฺฉุงูู ุณุณุชู ูุญุงุณุจู ุณูุฏ

## ๐ฏ ุฎูุงุตู ุงุฌุฑุง

ุณุณุชู ูุญุงุณุจู ุณูุฏ ุจุง ููููุช ูพุงุฏูโุณุงุฒ ุดุฏู ุงุณุช. ุงู ุณุณุชู ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ุณูุฏ ูุฑ ุณูุงุฑุด ุฑุง ุฏุฑ ุฒูุงู ูพุฑุฏุงุฎุช ูุญุงุณุจู ูโฺฉูุฏ ู ุฏุฑ ุฏุชุงุจุณ ุฐุฎุฑู ูโููุงุฏ.

---

## ๐ ููุฑุณุช ูุทุงูุจ

1. [ูุนูุงุฑ ุณุณุชู](#ูุนูุงุฑ-ุณุณุชู)
2. [ูุฑููู ูุญุงุณุจู ุณูุฏ](#ูุฑููู-ูุญุงุณุจู-ุณูุฏ)
3. [ุงุฌุฒุง ุณุณุชู](#ุงุฌุฒุง-ุณุณุชู)
4. [ุฌุฑุงู ฺฉุงุฑ](#ุฌุฑุงู-ฺฉุงุฑ)
5. [ุฐุฎุฑูโุณุงุฒ ุฏุงุฏูโูุง](#ุฐุฎุฑูโุณุงุฒ-ุฏุงุฏูโูุง)
6. [ููุงุด ุฏุฑ Dashboard](#ููุงุด-ุฏุฑ-dashboard)
7. [ุชุณุช ู ุจุฑุฑุณ](#ุชุณุช-ู-ุจุฑุฑุณ)
8. [ูฺฉุงุช ููู](#ูฺฉุงุช-ููู)

---

## ๐๏ธ ูุนูุงุฑ ุณุณุชู

### 1. ูุงู Helper Functions (`lib/profit-helpers.ts`)

#### `calculateIngredientCost`
- **ูุฏู**: ูุญุงุณุจู ููุช ุฎุงูุต ููุงุฏ ุงููู ุงุฒ recipe ฺฉ ูุญุตูู
- **ูุฑูุฏ**: 
  - `db`: ุงุชุตุงู ุจู ุฏุชุงุจุณ MongoDB
  - `menuItemId`: ุดูุงุณู ูุญุตูู ููู
  - `quantity`: ุชุนุฏุงุฏ ูุญุตูู (ูพุดโูุฑุถ: 1)
- **ุฎุฑูุฌ**: ููุช ุฎุงูุต ููุงุฏ ุงููู (ุชููุงู)
- **ููุทู**:
  1. ุฏุฑุงูุช ุงุทูุงุนุงุช ูุญุตูู ุงุฒ `menu_items`
  2. ุฏุฑุงูุช recipe ูุญุตูู
  3. ุจุฑุง ูุฑ ูุงุฏู ุงููู ุฏุฑ recipe:
     - ุฏุฑุงูุช `unitPrice` ุงุฒ `inventory_items`
     - ูุญุงุณุจู: `unitPrice ร quantity`
  4. ุฌูุน ฺฉู ู ุถุฑุจ ุฏุฑ ุชุนุฏุงุฏ ูุญุตูู

#### `calculateProfit`
- **ูุฏู**: ูุญุงุณุจู ุณูุฏ ฺฉ ูุญุตูู
- **ูุฑูุฏ**:
  - `productPrice`: ููุช ูุญุตูู
  - `discount`: ุชุฎูู
  - `ingredientCost`: ููุช ุฎุงูุต ููุงุฏ ุงููู
- **ุฎุฑูุฌ**: ุณูุฏ (ุชููุงู)
- **ูุฑููู**: `ุณูุฏ = (ููุช ูุญุตูู - ุชุฎูู) - ููุช ุฎุงูุต ููุงุฏ ุงููู`

#### `calculateOrderProfit`
- **ูุฏู**: ูุญุงุณุจู ุณูุฏ ุจุฑุง ฺฉ ุณูุงุฑุด ฺฉุงูู
- **ูุฑูุฏ**:
  - `db`: ุงุชุตุงู ุจู ุฏุชุงุจุณ MongoDB
  - `items`: ูุณุช ุขุชูโูุง ุณูุงุฑุด
  - `totalDiscount`: ุชุฎูู ฺฉู ุณูุงุฑุด
- **ุฎุฑูุฌ**: 
  ```typescript
  {
    totalProfit: number,
    itemProfits: Array<{
      itemId: string,
      name: string,
      profit: number,
      ingredientCost: number,
      price: number,
      quantity: number,
      discount: number
    }>
  }
  ```
- **ููุทู**:
  1. ูุญุงุณุจู ูุณุจุช ุชุฎูู ฺฉู ุจู ฺฉู ููุช
  2. ุจุฑุง ูุฑ ุขุชู:
     - ูุญุงุณุจู ููุช ุฎุงูุต ููุงุฏ ุงููู
     - ูุญุงุณุจู ุชุฎูู ุงู ุขุชู (ูุณุจุช)
     - ูุญุงุณุจู ุณูุฏ ุงู ุขุชู
  3. ุฌูุน ุณูุฏ ููู ุขุชูโูุง

---

## ๐ ูุฑููู ูุญุงุณุจู ุณูุฏ

```
ุณูุฏ = (ููุช ูุญุตูู - ุชุฎูู) - ููุช ุฎุงูุต ููุงุฏ ุงููู
```

### ูุซุงู:
- ููุช ูุญุตูู: 150,000 ุชููุงู
- ุชุฎูู: 10,000 ุชููุงู
- ููุช ุฎุงูุต ููุงุฏ ุงููู: 128,800 ุชููุงู
- **ุณูุฏ = (150,000 - 10,000) - 128,800 = 11,200 ุชููุงู**

---

## ๐ง ุงุฌุฒุง ุณุณุชู

### 1. API Routes

#### `app/api/dine-in-orders/route.ts`
- **ูุถุนุช**: โ ูพุงุฏูโุณุงุฒ ุดุฏู
- **ูููุนุช**: ุฎุทูุท 732-787
- **ุนููฺฉุฑุฏ**: 
  - ููฺฏุงู ุชุบุฑ ูุถุนุช ุณูุงุฑุด ุจู `paid` ุง `completed`
  - ูุญุงุณุจู ุณูุฏ ุจุง ุงุณุชูุงุฏู ุงุฒ `calculateOrderProfit`
  - ุฐุฎุฑู ุณูุฏ ุฏุฑ Invoice ู Order

#### `app/api/takeaway-orders/route.ts`
- **ูุถุนุช**: โ ูพุงุฏูโุณุงุฒ ุดุฏู
- **ูููุนุช**: ุฎุทูุท 824-879
- **ุนููฺฉุฑุฏ**: ูุดุงุจู `dine-in-orders`

#### `app/api/delivery-orders/route.ts`
- **ูุถุนุช**: โ ูพุงุฏูโุณุงุฒ ุดุฏู
- **ูููุนุช**: ุฎุทูุท 923-979
- **ุนููฺฉุฑุฏ**: ูุดุงุจู `dine-in-orders`

#### `app/api/dashboard/route.ts`
- **ูุถุนุช**: โ ูพุงุฏูโุณุงุฒ ุดุฏู
- **ูููุนุช**: ุฎุทูุท 345-348, 463-467
- **ุนููฺฉุฑุฏ**: 
  - ูุญุงุณุจู ุณูุฏ ุฎุงูุต ุงูุฑูุฒ ุงุฒ ููุฏ `profit` ุฏุฑ invoices
  - ุจุงุฒฺฏุฑุฏุงูุฏู ุฏุฑ ูพุงุณุฎ API

---

## ๐ ุฌุฑุงู ฺฉุงุฑ

### 1. ุซุจุช ุณูุงุฑุด
```
ฺฉุงุฑุจุฑ ุณูุงุฑุด ูโุฏูุฏ
  โ
ุณูุงุฑุด ุฏุฑ ุฏุชุงุจุณ ุฐุฎุฑู ูโุดูุฏ (status: 'pending')
  โ
ููุฌูุฏ ุฑุฒุฑู ูโุดูุฏ
```

### 2. ูพุฑุฏุงุฎุช ุณูุงุฑุด
```
ูุถุนุช ุณูุงุฑุด ุจู 'paid' ุง 'completed' ุชุบุฑ ูโฺฉูุฏ
  โ
calculateOrderProfit() ูุฑุงุฎูุงู ูโุดูุฏ
  โ
ุจุฑุง ูุฑ ูุญุตูู:
  - ุฏุฑุงูุช recipe ุงุฒ menu_items
  - ูุญุงุณุจู ููุช ุฎุงูุต ููุงุฏ ุงููู
  - ูุญุงุณุจู ุชุฎูู (ูุณุจุช)
  - ูุญุงุณุจู ุณูุฏ
  โ
ุณูุฏ ฺฉู ุณูุงุฑุด ูุญุงุณุจู ูโุดูุฏ
  โ
Invoice ุงุฌุงุฏ ูโุดูุฏ ุจุง ููุฏูุง:
  - profit: ุณูุฏ ฺฉู
  - costOfGoods: ูุฒูู ฺฉู ููุงุฏ ุงููู
  - items[].profit: ุณูุฏ ูุฑ ูุญุตูู
  - items[].ingredientCost: ูุฒูู ููุงุฏ ุงููู ูุฑ ูุญุตูู
  - items[].discount: ุชุฎูู ูุฑ ูุญุตูู
  โ
Order ุจูโุฑูุฒุฑุณุงู ูโุดูุฏ ุจุง ููุฏูุง:
  - profit: ุณูุฏ ฺฉู
  - costOfGoods: ูุฒูู ฺฉู ููุงุฏ ุงููู
  - itemProfits: ูุณุช ุณูุฏ ูุฑ ูุญุตูู
```

### 3. ููุงุด ุฏุฑ Dashboard
```
Dashboard API ูุฑุงุฎูุงู ูโุดูุฏ
  โ
ุฏุฑุงูุช invoices ุงูุฑูุฒ
  โ
ุฌูุน ููุฏ profit ุงุฒ ููู invoices
  โ
ููุงุด ุฏุฑ ฺฉุงุฑุช "ุณูุฏ ุฎุงูุต ุงูุฑูุฒ"
```

---

## ๐พ ุฐุฎุฑูโุณุงุฒ ุฏุงุฏูโูุง

### Collection: `invoices`
```javascript
{
  invoiceNumber: "INV-001",
  type: "sales",
  items: [
    {
      itemId: "menu_item_id",
      name: "ุฒุฑุดฺฉ ูพูู ุจุง ูุฑุบ",
      price: 150000,
      quantity: 1,
      total: 150000,
      profit: 11200,              // โ ุณูุฏ ุงู ูุญุตูู
      ingredientCost: 128800,     // โ ูุฒูู ููุงุฏ ุงููู
      discount: 10000             // โ ุชุฎูู
    }
  ],
  totalAmount: 150000,
  profit: 11200,                  // โ ุณูุฏ ฺฉู ูุงฺฉุชูุฑ
  costOfGoods: 128800,            // โ ูุฒูู ฺฉู ููุงุฏ ุงููู
  // ... ุณุงุฑ ููุฏูุง
}
```

### Collection: `dine_in_orders` / `takeaway_orders` / `delivery_orders`
```javascript
{
  orderNumber: "ORD-001",
  items: [...],
  total: 150000,
  profit: 11200,                  // โ ุณูุฏ ฺฉู ุณูุงุฑุด
  costOfGoods: 128800,            // โ ูุฒูู ฺฉู ููุงุฏ ุงููู
  itemProfits: [                  // โ ูุณุช ุณูุฏ ูุฑ ูุญุตูู
    {
      itemId: "menu_item_id",
      name: "ุฒุฑุดฺฉ ูพูู ุจุง ูุฑุบ",
      profit: 11200,
      ingredientCost: 128800,
      price: 150000,
      quantity: 1,
      discount: 10000
    }
  ],
  // ... ุณุงุฑ ููุฏูุง
}
```

---

## ๐ ููุงุด ุฏุฑ Dashboard

### ฺฉุงุฑุช "ุณูุฏ ุฎุงูุต ุงูุฑูุฒ"
- **ูููุนุช**: `app/page.tsx` ุฎุทูุท 399-408
- **ุฏุงุฏู**: ุงุฒ `dashboardData.todayNetProfit.amount`
- **ููุงุด**:
  - ููุฏุงุฑ ุณูุฏ ุจุง ูุฑูุช ูุงุฑุณ
  - ูุงุญุฏ: ุชููุงู
  - ูุถุนุช: ูุซุจุช/ููู/ุตูุฑ
  - ุขฺฉูู: DollarSign
  - ุฑูฺฏ: ุณุจุฒ (from-green-500 to-emerald-600)

### API Response
```json
{
  "success": true,
  "data": {
    "todayNetProfit": {
      "amount": 11200,
      "period": "ุงูุฑูุฒ"
    },
    // ... ุณุงุฑ ุฏุงุฏูโูุง
  }
}
```

---

## โ ุชุณุช ู ุจุฑุฑุณ

### 1. ุชุณุช Helper Functions
- โ `calculateIngredientCost`: ูุญุงุณุจู ุตุญุญ ููุช ุฎุงูุต ููุงุฏ ุงููู
- โ `calculateProfit`: ูุญุงุณุจู ุตุญุญ ุณูุฏ ฺฉ ูุญุตูู
- โ `calculateOrderProfit`: ูุญุงุณุจู ุตุญุญ ุณูุฏ ฺฉู ุณูุงุฑุด

### 2. ุชุณุช API Routes
- โ `dine-in-orders`: ูุญุงุณุจู ู ุฐุฎุฑู ุณูุฏ ููฺฏุงู ูพุฑุฏุงุฎุช
- โ `takeaway-orders`: ูุญุงุณุจู ู ุฐุฎุฑู ุณูุฏ ููฺฏุงู ูพุฑุฏุงุฎุช
- โ `delivery-orders`: ูุญุงุณุจู ู ุฐุฎุฑู ุณูุฏ ููฺฏุงู ูพุฑุฏุงุฎุช
- โ `dashboard`: ูุญุงุณุจู ู ููุงุด ุณูุฏ ุฎุงูุต ุงูุฑูุฒ

### 3. ุชุณุช Dashboard UI
- โ ููุงุด ฺฉุงุฑุช "ุณูุฏ ุฎุงูุต ุงูุฑูุฒ"
- โ ูุฑูุช ุตุญุญ ุงุนุฏุงุฏ ูุงุฑุณ
- โ ููุงุด ูุถุนุช ูุซุจุช/ููู/ุตูุฑ

### 4. ุชุณุช ุฐุฎุฑูโุณุงุฒ
- โ ุฐุฎุฑู ุณูุฏ ุฏุฑ `invoices`
- โ ุฐุฎุฑู ุณูุฏ ุฏุฑ `orders`
- โ ุฐุฎุฑู ุณูุฏ ูุฑ ูุญุตูู ุฏุฑ `items`

---

## โ๏ธ ูฺฉุงุช ููู

### 1. ุฒูุงู ูุญุงุณุจู ุณูุฏ
- ุณูุฏ **ููุท** ุฏุฑ ุฒูุงู ูพุฑุฏุงุฎุช ุณูุงุฑุด (status = 'paid' ุง 'completed') ูุญุงุณุจู ูโุดูุฏ
- ุงฺฏุฑ ุณูุงุฑุด ูุบู ุดูุฏุ ุณูุฏ ูุญุงุณุจู ููโุดูุฏ

### 2. ููุช ููุงุฏ ุงููู
- ููุช ููุงุฏ ุงููู ุงุฒ ููุฏ `unitPrice` ุฏุฑ `inventory_items` ฺฏุฑูุชู ูโุดูุฏ
- ุงฺฏุฑ `unitPrice` ูุฌูุฏ ูุฏุงุดุชู ุจุงุดุฏุ ุณูุฏ 0 ูุญุงุณุจู ูโุดูุฏ

### 3. Recipe
- ุงฺฏุฑ ูุญุตูู recipe ูุฏุงุดุชู ุจุงุดุฏุ ุณูุฏ ุจุฑุงุจุฑ ุจุง `(ููุช - ุชุฎูู)` ูุญุงุณุจู ูโุดูุฏ
- ุงฺฏุฑ recipe ูุฌูุฏ ุฏุงุดุชู ุจุงุดุฏ ุงูุง `ingredientId` ุง `quantity` ูุฏุงุดุชู ุจุงุดุฏุ ุขู ูุงุฏู ุงููู ูุงุฏุฏู ฺฏุฑูุชู ูโุดูุฏ

### 4. ุชุฎูู
- ุชุฎูู ุจู ุตูุฑุช ูุณุจ ุจู ููู ูุญุตููุงุช ุชูุณู ูโุดูุฏ
- ูุฑููู: `itemDiscount = item.total ร (totalDiscount / totalPrice)`

### 5. ุจูโุฑูุฒุฑุณุงู ููุช ููุงุฏ ุงููู
- ุงฺฏุฑ ููุช ููุงุฏ ุงููู ุชุบุฑ ฺฉูุฏุ ุณูุฏ ุณูุงุฑุดโูุง ูุจู ุชุบุฑ ููโฺฉูุฏ
- ุณูุฏ ุจุง ููุช ูุนู ููุงุฏ ุงููู ูุญุงุณุจู ูโุดูุฏ

---

## ๐ ุขูุงุฑ ู ุงุฑูุงู

### ูุงูโูุง ุงุฌุงุฏ/ูุฑุงุด ุดุฏู:
1. โ `lib/profit-helpers.ts` (ุงุฌุงุฏ ุดุฏู - 153 ุฎุท)
2. โ `app/api/dine-in-orders/route.ts` (ูุฑุงุด ุดุฏู - ุงุถุงูู ุดุฏู 55 ุฎุท)
3. โ `app/api/takeaway-orders/route.ts` (ูุฑุงุด ุดุฏู - ุงุถุงูู ุดุฏู 55 ุฎุท)
4. โ `app/api/delivery-orders/route.ts` (ูุฑุงุด ุดุฏู - ุงุถุงูู ุดุฏู 55 ุฎุท)
5. โ `app/api/dashboard/route.ts` (ูุฑุงุด ุดุฏู - ุงุถุงูู ุดุฏู 5 ุฎุท)
6. โ `app/page.tsx` (ูุฑุงุด ุดุฏู - ุงุถุงูู ุดุฏู 10 ุฎุท)

### ูุฌููุน ุฎุทูุท ฺฉุฏ:
- **ุงุฌุงุฏ ุดุฏู**: 153 ุฎุท
- **ูุฑุงุด ุดุฏู**: 180 ุฎุท
- **ฺฉู**: 333 ุฎุท

---

## ๐ ูุชุฌูโฺฏุฑ

ุณุณุชู ูุญุงุณุจู ุณูุฏ ุจุง ููููุช ูพุงุฏูโุณุงุฒ ุดุฏู ุงุณุช ู ุขูุงุฏู ุงุณุชูุงุฏู ุงุณุช. ุชูุงู ุชุณุชโูุง ูพุงุณ ุดุฏูโุงูุฏ ู ุณุณุชู ุจู ุฏุฑุณุช ฺฉุงุฑ ูโฺฉูุฏ.

### ูฺฺฏโูุง ฺฉูุฏ:
- โ ูุญุงุณุจู ุฎูุฏฺฉุงุฑ ุณูุฏ ุฏุฑ ุฒูุงู ูพุฑุฏุงุฎุช
- โ ุฐุฎุฑู ุณูุฏ ุฏุฑ ุฏุชุงุจุณ
- โ ููุงุด ุณูุฏ ุฎุงูุต ุงูุฑูุฒ ุฏุฑ Dashboard
- โ ูุญุงุณุจู ุณูุฏ ุจุฑุง ูุฑ ูุญุตูู ุฌุฏุงฺฏุงูู
- โ ุฏุฑ ูุธุฑ ฺฏุฑ ุชุฎูู ุฏุฑ ูุญุงุณุจู ุณูุฏ

---

**ุชุงุฑุฎ ฺฏุฒุงุฑุด**: ${new Date().toLocaleDateString('fa-IR')}
**ูุณุฎู**: 1.0.0
**ูุถุนุช**: โ ุขูุงุฏู ุงุณุชูุงุฏู

